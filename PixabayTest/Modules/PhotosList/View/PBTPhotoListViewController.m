//// PBTPhotoListViewController// PixabayTest////  Created by azat on 27/05/16.//  Copyright (c) 2016. All rights reserved.//#import <SDWebImage/SDWebImageManager.h>#import <FrameAccessor.h>#import "PBTPhotoListViewController.h"#import "PBTPhotoListViewOutput.h"#import "PBTPhotoTableViewCell.h"#import "PBTPhoto.h"@interface PBTPhotoListViewController () <UISearchResultsUpdating>@property (nonatomic, strong) NSArray *photos;@property (nonatomic, strong) UIView *loadingView;@property (nonatomic, strong) UISearchController *searchController;@property (nonatomic, strong) UILabel *emptyDataPlaceholder;@end@implementation PBTPhotoListViewController#pragma mark - View Lifecycle- (void)viewDidLoad{    [super viewDidLoad];    NSString *identifier = [PBTPhotoTableViewCell cellIdentifier];    [self.tableView registerClass:[PBTPhotoTableViewCell class] forCellReuseIdentifier:identifier];    self.tableView.rowHeight = 60.0f;    [self configureSearchBar];    self.tableView.tableFooterView = [UIView new];    self.tableView.keyboardDismissMode = UIScrollViewKeyboardDismissModeInteractive;    [self.output viewDidFinishLoading];}#pragma mark - View Input Methods- (void)setTitle:(NSString *)title{    self.navigationItem.title = title;}- (void)cleanPhotos{    self.photos = @[];    [self.tableView reloadData];}- (void)showPhotos:(NSArray *)photos{    self.photos = photos;    [self.tableView reloadData];    self.emptyDataPlaceholder.hidden = photos.count != 0;}- (void)showLoader{    self.tableView.tableFooterView = self.loadingView;    self.emptyDataPlaceholder.hidden = YES;}- (void)hideLoader{    self.tableView.tableFooterView = [UIView new];}- (void)showErrorWithMessage:(NSString *)message{    UIAlertController *alert = [UIAlertController alertControllerWithTitle:@"Error"                                                                   message:message                                                            preferredStyle:UIAlertControllerStyleAlert];    UIAlertAction *closeAction = [UIAlertAction actionWithTitle:@"Close"                                                          style:UIAlertActionStyleDefault                                                        handler:nil];    [alert addAction:closeAction];    [self presentViewController:alert                       animated:YES                     completion:nil];}#pragma mark - Table View Delegate & Data Source Methods- (NSInteger)numberOfSectionsInTableView:(UITableView *)tableView{    return 1;}- (NSInteger)tableView:(UITableView *)tableView numberOfRowsInSection:(NSInteger)section{    return self.photos.count;}- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath{    NSString *identifier = [PBTPhotoTableViewCell cellIdentifier];    PBTPhotoTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:identifier];    if (!cell)    {        cell = [[PBTPhotoTableViewCell alloc] initWithStyle:UITableViewCellStyleSubtitle                                            reuseIdentifier:identifier];    }    NSUInteger photoIndex = (NSUInteger)indexPath.row;    PBTPhoto *photo = self.photos[photoIndex];    cell.imageView.image = nil;    [cell configureWithPhoto:photo];    return cell;}- (void)tableView:(UITableView *)tableView didSelectRowAtIndexPath:(NSIndexPath *)indexPath{    PBTPhoto *photo = self.photos[indexPath.row];    [self.searchController.searchBar resignFirstResponder];    [self.output didSelectPhoto:photo];}- (void)scrollViewDidScroll:(UIScrollView *)scrollView{    if (scrollView.contentOffset.y + self.tableView.bounds.size.height > scrollView.contentSize.height)    {        [self.output didScrollToBottom];    }}#pragma mark - Setters & Getters- (UIView *)loadingView{    if (!_loadingView)    {        _loadingView = [[UIView alloc] initWithFrame:CGRectMake(0.0f, 0.0f, [UIScreen mainScreen].bounds.size.width, 70.0f)];        UIActivityIndicatorView *spinner = [[UIActivityIndicatorView alloc] initWithActivityIndicatorStyle:UIActivityIndicatorViewStyleGray];        [_loadingView addSubview:spinner];        spinner.center = _loadingView.center;        [spinner startAnimating];    }    return _loadingView;}- (UILabel *)emptyDataPlaceholder{    if (!_emptyDataPlaceholder)    {        _emptyDataPlaceholder = [UILabel new];        _emptyDataPlaceholder.text = @"No photos";        [_emptyDataPlaceholder sizeToFit];        _emptyDataPlaceholder.textColor = [UIColor lightGrayColor];        [self.view addSubview:_emptyDataPlaceholder];        _emptyDataPlaceholder.centerX = self.view.centerX;        _emptyDataPlaceholder.top = self.navigationController.navigationBar.bounds.size.height + 20.0f;        _emptyDataPlaceholder.hidden = YES;    }    return _emptyDataPlaceholder;}#pragma mark - Private Utils- (void)configureSearchBar{    self.searchController = [[UISearchController alloc] initWithSearchResultsController:nil];    self.searchController.searchResultsUpdater = self;    self.searchController.searchBar.barTintColor = [UIColor lightGrayColor];    self.searchController.searchBar.backgroundImage = [UIImage new];    self.searchController.searchBar.backgroundColor = [UIColor colorWithRed:0.96 green:0.97 blue:0.98 alpha:1.00];    self.searchController.dimsBackgroundDuringPresentation = NO;    self.searchController.hidesNavigationBarDuringPresentation = NO;    self.definesPresentationContext = YES;    if ([[[UIDevice currentDevice] systemVersion] compare:@"9.0" options:NSNumericSearch] == NSOrderedAscending)    {        [self.searchController.searchBar sizeToFit];    }    self.tableView.tableHeaderView = self.searchController.searchBar;}#pragma mark - Search delegate- (void)updateSearchResultsForSearchController:(UISearchController *)searchController{    [self.output searchTextDidChanged:searchController.searchBar.text];}@end